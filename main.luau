--[[
    BFS Scripts v4.2 ULTIMATE
    Loader Principal
]]

-- Notificaci√≥n inmediata
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "BFS Loader",
        Text = "Iniciando carga...",
        Duration = 3,
    })
end)

-- Configuraci√≥n
local REPO = "https://raw.githubusercontent.com/Emir5021-Gob/BFS/main/Games/"

-- IDs de juego soportados (incluye BETA y variantes)
local GAMES = {
    -- Blox Fruits Main
    [2753915549] = "BloxFruits.luau", -- Sea 1
    [4442272183] = "BloxFruits.luau", -- Sea 2
    [7449423635] = "BloxFruits.luau", -- Sea 3
    -- Blox Fruits BETA/Test
    [13498489180] = "BloxFruits.luau", -- BETA
    [15541073133] = "BloxFruits.luau", -- BETA 2
}

-- Detectar juego
local placeId = game.PlaceId
local scriptName = GAMES[placeId]

-- Si no est√° en la lista, detectar autom√°ticamente si es Blox Fruits
if not scriptName then
    -- M√©todo 1: Verificar por elementos del juego
    local isBloxFruits = false
    pcall(function()
        local rs = game:GetService("ReplicatedStorage")
        if rs:FindFirstChild("Remotes") and rs.Remotes:FindFirstChild("CommF_") then
            isBloxFruits = true
        end
    end)
    
    -- M√©todo 2: Verificar por nombre del juego
    if not isBloxFruits then
        pcall(function()
            local gameName = game:GetService("MarketplaceService"):GetProductInfo(placeId).Name or ""
            if gameName:lower():find("blox") and gameName:lower():find("fruit") then
                isBloxFruits = true
            end
        end)
    end
    
    if isBloxFruits then
        scriptName = "BloxFruits.luau"
        print("‚úÖ Detectado como Blox Fruits autom√°ticamente")
    end
end

print("=" .. string.rep("=", 50))
print("üöÄ BFS SCRIPTS v4.2 ULTIMATE")
print("=" .. string.rep("=", 50))
print("üéÆ PlaceId:", placeId)

-- Verificar si el juego es soportado
if not scriptName then
    warn("‚ö†Ô∏è JUEGO NO SOPORTADO")
    warn("PlaceId actual:", placeId)
    warn("Juegos soportados:")
    warn("  ‚Ä¢ 2753915549 - Blox Fruits Sea 1")
    warn("  ‚Ä¢ 4442272183 - Blox Fruits Sea 2")
    warn("  ‚Ä¢ 7449423635 - Blox Fruits Sea 3")
    warn("  ‚Ä¢ 13498489180 - Blox Fruits BETA")
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "‚ùå Juego no soportado",
            Text = "PlaceId: " .. tostring(placeId),
            Duration = 10,
        })
    end)
    return
end

print("‚úÖ Juego detectado:", scriptName)

-- Descargar el script
local url = REPO .. scriptName
print("üì• Descargando:", url)

local code
local downloadSuccess, downloadError = pcall(function()
    code = game:HttpGet(url, true)
end)

if not downloadSuccess then
    warn("‚ùå ERROR EN DESCARGA:")
    warn(tostring(downloadError))
    return
end

if not code or code == "" then
    warn("‚ùå ERROR: Script vac√≠o o no encontrado")
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "‚ùå Error Descarga",
            Text = "Script vac√≠o",
            Duration = 10,
        })
    end)
    return
end

print("‚úÖ Descargado:", #code, "bytes")

pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "‚úÖ Descargado",
        Text = #code .. " bytes",
        Duration = 2,
    })
end)

print("‚öôÔ∏è Compilando...")

-- Compilar el script
local func, compileError = loadstring(code)

if not func then
    warn("‚ùå ERROR DE COMPILACI√ìN:")
    warn(tostring(compileError))
    -- Mostrar primeras l√≠neas con error
    local lines = {}
    for line in code:gmatch("[^\r\n]+") do
        table.insert(lines, line)
    end
    warn("Total de l√≠neas:", #lines)
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "‚ùå Error Compilaci√≥n",
            Text = tostring(compileError):sub(1, 50),
            Duration = 15,
        })
    end)
    return
end

print("‚úÖ Compilaci√≥n exitosa")

pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "‚úÖ Compilado",
        Text = "Ejecutando...",
        Duration = 2,
    })
end)

print("üéÆ Ejecutando script...")

-- Ejecutar el script CON MANEJO DE ERRORES
local executeSuccess, executeError = pcall(func)

if not executeSuccess then
    warn("‚ùå ERROR EN EJECUCI√ìN:")
    warn(tostring(executeError))
    
    -- Notificaci√≥n visual del error
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "‚ùå ERROR BFS",
            Text = "Ver consola (F9) para detalles",
            Duration = 10,
        })
    end)
    return
end

print("‚úÖ BFS Scripts cargado completamente!")

